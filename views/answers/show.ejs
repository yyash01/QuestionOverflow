<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/styles.css" />
    <!-- Include stylesheet for Quill and highlight.js-->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/monokai-sublime.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.quilljs.com/1.3.6/quill.bubble.css"
    />

    <!-- Inlcude Scripts for Quill and highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
    <script
      src="https://kit.fontawesome.com/6e18d74916.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <nav>
      <h1>
        <a href="/">DashBoard</a>
      </h1>
      <ul>
        <% if (user) { %>
        <li>Welcome, <b>DevStars</b></li>
        <li>
          <a href="/logout" class="btn"
            >Logout <i class="fas fa-sign-out-alt"></i>
          </a>
        </li>
        <% } else { %>
        <li><a href="/login">Log in</a></li>
        <li><a href="/signup" class="btn">Sign up</a></li>
        <% } %>
      </ul>
    </nav>

    <div class="answer" style="margin-top: -80px">
      <div class="Row" style="margin-left: 300px">
        <div class="Column"><h2><%= answer.topic %></h2></div>
      </div>
      <div class="Row" style="margin-left: 300px">
        <p style=" font-size: 25px; color: grey;">Author : <%= answer.author.name %></p>
      </div>
      <div class="Row">
        <div id="editor-answer">
          <pre id="json"><%= answer.content %></pre>
        </div>
        <script>
          // console.log(question._id);
          var quill = new Quill("#editor-answer", {
            modules: {
              syntax: true,
              clipboard: {
                matchVisual: false,
              },
            },
            placeholder: "Add Your Code Here...",
            theme: "bubble",
          });
          var justTextContent = document.getElementById("justText");
        </script>
      </div>
      <div class="Row" style="margin-left: 300px">
        <div class="Column">
          <div class="comment-box">
            <form class="comentForm">
              <textarea type="text" name="comment" required></textarea>
              <button class="btn-success-comment">
                <p class="textC">comment</p>
              </button>
            </form>
            <script>
              const form = document.querySelector("form");
              form.addEventListener("submit", async (e) => {
                e.preventDefault();
                //get comment
                const topic = form.comment.value;
                try {
                  const res = await fetch(
                    "/answer/<%= answer._id %>/comment/new",
                    {
                      method: "POST",
                      body: JSON.stringify({ topic }),
                      headers: { "Content-Type": "application/json" },
                    }
                  );
                  const data = await res.json();
                  if (data.commentID) {
                    location.assign("/answer/show/<%= answer._id %>");
                  }
                } catch (err) {
                  console.log(err);
                }
              });
            </script>
          </div>
        </div>
      </div>
      <% if(answer.comments.length === 0){ %>
      <div class="cc-box">
        <div class="Row"><h3>No Comments Availaible </h3></div>
      </div>
      <%} else { answer.comments.forEach(function(comment){ %>
      <div class="cc-box">
        <div class="Row">
          <p style="margin-bottom: 20px; font-size: 20px; color: grey;"><%= comment.author.name %></p>
            <div class="simple">
              <p><%= comment.topic %></p>
              <% if(user && comment.author.id.equals(user._id)){ %>
                <button type="submit">
                  <i class="fas fa-trash"></i>
                </button>
              <% } %>
          </div>
          </div>
        </div>
      </div>
      <% })} %>
    </div>
  </body>
</html>
