<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/styles.css" />
    <!-- Include stylesheet for Quill and highlight.js-->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/monokai-sublime.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.quilljs.com/1.3.6/quill.bubble.css"
    />

    <!-- Inlcude Scripts for Quill and highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
    <script
      src="https://kit.fontawesome.com/6e18d74916.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <nav>
      <h1>
        <a href="/">DashBoard</a>
      </h1>
      <ul>
        <% if (user) { %>
        <li>Welcome, <b>DevStars</b></li>
        <li>
          <a href="/logout" class="btn"
            >Logout <i class="fas fa-sign-out-alt"></i>
          </a>
        </li>
        <% } else { %>
        <li><a href="/login">Log in</a></li>
        <li><a href="/signup" class="btn">Sign up</a></li>
        <% } %>
      </ul>
    </nav>

    <div class="answer" style="margin-top: -80px">
      <div class="Row" style="margin-left: 300px">
        <div class="Column"><h2><%= answer.topic %></h2></div>
      </div>
      <div class="Row" style="margin-left: 250px">
        <div class="Column" style="margin-top: -100px">
          <button type="button" class="btn-success-op">
            <a href="#" class="textC">
              Author<i
                style="margin-left: 5px"
                class="fas fa-angle-double-right"
              ></i>
            </a>
          </button>
        </div>
      </div>
      <div class="Row">
        <div id="editor-answer">
          <pre id="json"><%= answer.content %></pre>
        </div>
        <script>
          // console.log(question._id);
          var quill = new Quill("#editor-answer", {
            modules: {
              syntax: true,
              clipboard: {
                matchVisual: false,
              },
            },
            placeholder: "Add Your Code Here...",
            theme: "bubble",
          });
          var justTextContent = document.getElementById("justText");
        </script>
      </div>
      <div class="Row" style="margin-left: 300px">
        <div class="Column">
          <div class="comment-box">
            <form class="comentForm">
              <textarea type="text" name="comment" required></textarea>
              <button class="btn-success-comment">
                <a href="#" class="textC">
                  Add Comment<i
                    style="margin-left: 5px"
                    class="fas fa-angle-double-right"
                  ></i>
                </a>
              </button>
            </form>
            <script>
              const form = document.querySelector("form");
              form.addEventListener("submit", async (e) => {
                e.preventDefault();

                //get comment
                const topic = form.comment.value;
                try {
                  const res = await fetch(
                    "/answer/<%= answer._id %>/comment/new",
                    {
                      method: "POST",
                      body: JSON.stringify({ topic }),
                      headers: { "Content-Type": "application/json" },
                    }
                  );
                  const data = await res.json();
                  console.log(data);
                } catch (err) {
                  console.log(err);
                }
              });
            </script>
          </div>
        </div>
      </div>
      <% answer.comments.forEach(function(comment){ %> <% if(comment){ %>
      <div class="cc-box">
        <div class="Row">
          <div class="Column">
            <div class="simple">
              <p><%= comment.topic %></p>
              <% if(user && comment.author.id.equals(user._id)){ %>
              <form
                id="delete-form"
                action="/answer/<%=answer._id %>?_method=DELETE"
                method="POST"
              >
                <button
                  type="submit"
                  class="btn-success-solve"
                  style="color: aliceblue; margin-top: auto"
                >
                  Delete
                </button>
              </form>
              <% } %>
            </div>
          </div>
        </div>
      </div>
      <% }}) %>
    </div>
  </body>
</html>
